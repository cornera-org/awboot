# ------------------------------------------------------------
# Allwinner T113-S3 + ESP-Prog (FT2232H) JTAG adapter
# Using Espressif's default interface mapping
# ------------------------------------------------------------

# --- Interface ---
source [find interface/ftdi/esp32_devkitj_v1.cfg]

# Use raw JTAG (not SWD)
transport select jtag

# --- Safety / timing ---
reset_config none          ;# don't assert reset (FEL pinmux would be lost)
adapter speed 100          ;# start slow; increase once stable
ftdi tdo_sample_edge falling

# --- DAP/TAP (ARMv7-A A7 cores) ---
set _CHIP t113s3
source [find target/swj-dp.tcl]

# Start tolerant (no expected-id)
swj_newdap $_CHIP dap -irlen 4
dap create $_CHIP.dap -chain-position $_CHIP.dap

# --- Target definition ---
target create $_CHIP.cpu0 cortex_a -dap $_CHIP.dap -coreid 0 -endian little
# target create $_CHIP.cpu1 cortex_a -dap $_CHIP.dap -coreid 1 -endian little
# target smp $_CHIP.cpu0 $_CHIP.cpu1

# After examine, halt and bump speed
$_CHIP.cpu0 configure -event examine-end { halt; adapter speed 4000 }

echo "T113-S3 via ESP-Prog (esp32_devkitj_v1 interface) ready."
